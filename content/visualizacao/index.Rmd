---
title: "Visualização"
author: "Julio Trecenti, Daniel Falbel"
date: 2016-11-11
---

```{r, message=FALSE, warning=FALSE, include=FALSE}
knitr::opts_chunk$set(
  collapse = TRUE, 
  out.width = "60%", out.height = "60%",
  fig.retina = 0.5
)
```


Para este tópico vamos utilizar o `ggplot2`. O `ggplot2` é um pacote do R voltado
para a criação de gráficos estatísticos. Ele é baseado na Gramática dos Gráficos
(*grammar of graphics*, em inglês), criado por Leland Wilkinson, que é uma 
resposta para a pergunta: o que é um gráfico estatístico? Resumidamente, a gramática
diz que um gráfico estatístico é um mapeamento dos dados a partir de atributos
estéticos (cores, formas, tamanho) em formas geométricas (pontos, linhas, barras).

Para mais informações sobre a Gramática dos Gráficos, você pode consultar o livro
[*The Grammar of graphics*](http://www.springer.com/statistics/computational+statistics/book/978-0-387-24544-7), 
escrito pelo Leland Wilkinson, ou o livro [ggplot2: elegant graphics for data analysis](http://ggplot2.org/book/), do Hadley Wickham. 
Um [pdf do livro](http://moderngraphics11.pbworks.com/f/ggplot2-Book09hWickham.pdf) também está disponível.

Instale o pacote digitando `install.packages("ggplot2")`.

## Banco de dados

A seguir, vamos discutir os aspectos básicos para a construção de gráficos com o
pacote `ggplot2`. Para isso, utilizaremos o banco de dados contido no objeto `mtcars`.
Para visualizar as primeiras linhas deste banco, utilize o comando:

```{r}
head(mtcars)
```

O `mtcars` é um banco de dados de 1974 extraído da revista *Motor Trend US* que
compreende consumo de combustível e outros 10 aspectos de performance e engenharia
de 32 automóveis.

Entre as variáveis deste banco de dados estão:

- `mpg`: consumo de combustível (milhas por galão)
- `disp`: cilindrada, que é o [volume de deslocamento do motor](https://pt.wikipedia.org/wiki/Cilindrada)

Para saber mais sobre o `mtcarts`, digite `help(mtcars)`.

## As camadas de um gráfico

Antes de mais nada, vamos carregar o `ggplot2` usando:

```{r}
library(ggplot2)
```

No `ggplot2`, os gráficos são construídos camada por camada (ou, *layers*, em inglês),
sendo que a primeira delas é dada pela função `ggplot` (não tem o "2"). Cada camada
representa um tipo de mapeamento ou personalização do gráfico. O código abaixo é um
exemplo de um gráfico bem simples, construído a partir das duas principais camadas. 

```{r grafico1}
ggplot(data = mtcars, aes(x = disp, y = mpg)) + 
  geom_point()
```

Observe que o primeiro argumento da função `ggplot` é um data frame. A função `aes()`
descreve como as variáveis são mapeadas em aspectos visuais de formas geométricas
definidas pelos *geoms*. Aqui, essas formas geométricas são pontos, selecionados pela
função `geom_point()`, gerando, assim, um gráfico de dispersão. A combinação dessas
duas camadas define o tipo de gráfico que você deseja construir.

## Aesthetics

A primeira camada de um gráfico deve indicar a relação entre os dados e cada aspecto
visual do gráfico, como qual variável será representada no eixo x, qual será
representada no eixo y, a cor e o tamanho dos componentes geométricos etc. Os aspectos
que podem ou devem ser mapeados depende do tipo de gráfico que você deseja fazer.

No exemplo acima, atribuímos aspectos de posição: ao eixo y mapeamos a variável `mpg`
(milhas por galão) e ao eixo x a variável `disp` (cilindradas). Outro aspecto que pode
ser mapeado nesse gráfico é a cor dos pontos


```{r mapear_am}
ggplot(data = mtcars, aes(x = disp, y = mpg, colour = as.factor(am))) + 
  geom_point()
```

Agora, a variável `am` (tipo de transmissão) foi mapeada à cor dos pontos, sendo que pontos vermelhos correspondem à transmissão automática (valor 0) e pontos azuis à transmissão manual (valor 1). Observe que inserimos a variável `am` como um fator, pois temos interesse apenas nos valores "0" e "1". No entanto, tambem podemos mapear uma variável contínua à cor dos pontos:

```{r mapear_cor}
ggplot(mtcars, aes(x = disp, y = mpg, colour = cyl)) + 
  geom_point()
```

Aqui, o número de cilindros, `cyl`, é representado pela tonalidade da cor azul.

**Nota**: por *default*, a legenda é insirida no gráfico automaticamente.

Também podemos mapear o tamanho dos pontos à uma variável de interesse:

```{r mapear_tamanaho}
ggplot(mtcars, aes(x = disp, y = mpg, colour = cyl, size = wt)) +
  geom_point()
```

**Exercício**: pesquisar mais aspectos que podem ser alterados no gráfico de dispersão.